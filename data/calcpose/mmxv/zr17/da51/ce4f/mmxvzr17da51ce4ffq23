{"data":{"css":".pad10{\n  margin:10px;\n}\n\n.widebutton{\n  width: 100%;\n  margin-bottom:10px;\n}\n\n.mdl-button--accent.mdl-button--accent.mdl-button--raised, .mdl-button--accent.mdl-button--accent.mdl-button--fab{\n  color: white;\n}\n\n.showontarget{\n  display:none;\n}\n\n.humandisplay{\n  max-width:100%;\n}","data":[],"name":"calcpose","js":"var me = this; \nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(api){\n  componentHandler.upgradeAllRegistered();\n  me.updateSnapshot();\n  \n  $(ME).find('.maximizebutton').click(function(){ me.maximize(me.updateSnapshot); });\n  $(ME).find('.resetcambutton').click(function(){ me.resetCamera(me.updateSnapshot); });\n  $(ME).find('.modvalslider').change(function(){ \n    $(ME).find('.modvalfield').val($(this).val()/100); \n    me.setModifier(me.updateSnapshot); \n  });\n  $(ME).find('.modvalfield').change(function(){ \n    $(ME).find('.modvalslider').val($(this).val()*100); \n    me.setModifier(me.updateSnapshot); \n  });\n  \n  $(ME).find('.targetbygroup').click(function(){ \n    var group = $(ME).find('.modgroupselect').find('select').val();\n    modifiers = [];\n    for (var i in me.modifiers[group]){\n      modifiers.push(group+\"/\"+me.modifiers[group][i]);\n    }\n    console.log(modifiers);\n    step = Number($(ME).find('.approachstepfield').val());\n    $(ME).find('.hideonapproach').css('display', 'none')\n    $(ME).find('.showonapproach').html('<i>Beginning approach...<\/i>');\n    var gennum = 1;\n    function nextGen(){\n      var stepnum = 1;\n      function nextStep(){\n        send_approach_target(modifiers, step, function(result){\n          var data = JSON.parse(result.msg);\n          console.log(data);\n          var newhtml = 'Generation: '\n            + gennum\n            + '<br>Step: '\n            + stepnum++\n            + '<br>Step size: '\n            + step\n            + '<br>Loss function: '\n            + Math.round(data.loss)\n            + '<br>Number of changes: '\n            + data.count;\n          $(ME).find('.showonapproach').html(newhtml);\n          me.addThumb();\n          if (data.count == 0) {\n            step *= Number($(ME).find('.shrinkagefield').val());\n            if (step>=Number($(ME).find('.minstepfield').val())) {\n              gennum++;\n              me.updateSnapshot(nextGen);\n            }\n            else {\n              $(ME).find('.hideonapproach').css('display', 'block');\n              me.updateSnapshot(me.addThumb);\n            }\n          }\n          else me.updateSnapshot(nextStep);\n        });\n      }\n      nextStep();\n    }\n    nextGen();\n  });\n\n  $(ME).find('.clearthumbsbutton').click(function(){ \n    $(ME).find('.thumbs').empty();\n  });\n  \n  $(ME).find('.playthumbsbutton').click(function(){ \n    var imgs = $(ME).find('.thumbs').find('img');\n    var list = []\n    var i = imgs.length;\n    while (i-->0) {\n      list.push($(imgs[i]));\n      console.log(typeof imgs[i]);\n    }\n    function showNext(){\n      if (list.length>0){\n        $(ME).find('.humandisplay').prop('src', list.pop().prop('src'));\n        setTimeout(showNext, 100);\n      }\n    }\n    showNext();\n  });\n  \n  $(ME).find('.addthumbbutton').click(function(){ \n    me.addThumb();\n  });\n  \n  $(ME).find('.refreshhumanbutton').click(function(){ \n    me.updateSnapshot();\n  });\n\n  $(ME).find('.fixzrotbutton').click(function(){ \n    $(ME).find('.targetzrot').text('--');\n    send_optimize_rotation(function(result){\n      url = result.data.data;\n      var el = $('#targetimage');\n      el.attr('src', url);\n      $(ME).find('.targetzrot').text(result.data.rotation);\n    });\n  });\n  \n  $(ME).find('.targetuploadfile').change(function(){ \n    var file = this.files[0];\n    if (file) {\n        var reader = new FileReader();\n        reader.onload = function (e) {\n          var el = $('#targetimage');\n          var url = e.target.result;\n          send_set_target(url, function(result){\n            if (result.status != 'ok') {\n              alert(result.msg);\n              $(ME).find('.showontarget').css('display', 'none');\n            }\n            else {\n              url = result.msg;\n              el.attr('src', url);\n              $(ME).find('.showontarget').css('display', 'block');\n            }\n          });\n        }\n        reader.onerror = function (evt) {\n            alert(\"error reading file\");\n        }\n        reader.readAsDataURL(file);\n    }\n  });\n  \n  send_list_modifiers(function(result){\n    var d = {};\n    var n = [];\n    for (var i in result.data){\n      rdi = result.data[i];\n      var j = rdi.indexOf(\"/\");\n      var group = rdi.substring(0,j);\n      var modifier = rdi.substring(j+1);\n      if (!d[group]) {\n        d[group] = [];\n        n.push(group);\n      }\n      d[group].push(modifier);\n    }\n    //d.all = n;\n    me.modifiers = d;\n    d = {\n      \"label\": \"Group\",\n      \"list\": n,\n      \"ready\": function(api){\n        me.groupapi = api;\n        me.selectGroup(api.value());\n      },\n      \"cb\": me.selectGroup\n    };\n    installControl($(ME).find('.modgroupselect')[0], \"metabot\", \"select\", function(api){}, d);\n  });\n};\n\nme.setModifier = function(cb){\n  var group = $(ME).find('.modgroupselect').find('select').val();\n  var modifier = $(ME).find('.modifierselect').find('select').val();\n  var val = $(ME).find('.modvalfield').val();\n  send_modify(group+'/'+modifier, val, function(result){ \n    console.log(result); \n    if (cb) cb();\n  });\n};\n\nme.selectGroup = function(group){\n  d = {\n    \"label\": \"Modifier\",\n    \"list\": me.modifiers[group],\n    \"ready\": function(api){\n      me.selectModifier(group, api.value());\n    },\n    \"cb\": function(val){\n      me.selectModifier(group, val);\n    }\n  };\n  installControl($(ME).find('.modifierselect')[0], \"metabot\", \"select\", function(api){}, d);\n};\n\nme.selectModifier = function(group, modifier){\n  var mod = group+'/'+modifier;\n  send_get_modifier_value(mod, function(result){\n    console.log(result);\n    var val = result.data ? result.data[mod] : 0.0;\n    $(ME).find('.modvalfield').val(val);\n    $(ME).find('.modvalslider').val(100*val);\n  });\n};\n\nme.addThumb = function(){\n  var img = $('<img width=\"60\"/>');\n  img.prop('src', $(ME).find('.humandisplay').prop('src'));\n  img.click(function(e){\n    $(ME).find('.humandisplay').prop('src', $(this).prop('src'));\n  });\n  $(ME).find('.thumbs').append(img);\n};\n\nme.updateSnapshot = function(cb){\n  send_snapshot(function(result){\n    if (result.status != \"ok\") alert(result.msg);\n    else {\n      $(ME).find('.humandisplay').prop('src', result.msg);\n      if (cb) cb();\n    }\n  });\n};\n\nme.resetCamera = function(cb){\n  send_reset_camera(function(result){\n    if (result.status != \"ok\") alert(result.msg);\n    else if (cb) cb();\n  });\n};\n\nme.maximize = function(cb){\n  send_maximize(function(result){\n    if (result.status != \"ok\") alert(result.msg);\n    else if ((typeof cb) == 'function') cb();\n  });\n};","groups":"","ctl":"mmxvzr17da51ce4ffq23","html":"<div class=\"mdl-layout mdl-js-layout mdl-layout--fixed-drawer\">\n  <div class=\"mdl-layout__drawer\">\n    <span class=\"mdl-layout-title\">Calcpose<\/span>\n    <div class='pad10'>\n      <div class='hideonapproach'>\n        <div class='modgroupselect'><\/div>\n        <div class='modifierselect'><\/div>\n        <table cellpadding='0' cellspacing='0' border='0'>\n          <tr>\n            <td>\n                <input type='text' size='1' class='modvalfield' />\n            <\/td>\n            <td>\n                <input class=\"modvalslider mdl-slider mdl-js-slider\" type=\"range\" min=\"-100\" max=\"100\" value=\"0\" tabindex=\"0\">\n            <\/td>\n          <\/tr>\n        <\/table>\n        <br>\n        <button class=\"maximizebutton widebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">\n          Maximize\n        <\/button>\n        <br>\n        <button class=\"resetcambutton widebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">\n          Reset Camera\n        <\/button>\n      <\/div>\n      <b>Target:<\/b>\n      <img id='targetimage' width='100%'>\n      <div class='hideonapproach'>\n        <input type=\"file\"\n         id=\"avatar\" name=\"avatar\"\n         xaccept=\"image/png, image/jpeg\"\n         class=\"targetuploadfile\">\n        <div class='showontarget'>\n          <br>\n          <b>Target Rotation:<\/b> <span class='targetzrot'>0.0<\/span>\n          <br><br>\n          <button class=\"fixzrotbutton widebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">\n            Optimize Rotation\n          <\/button>\n\t\t  <br><br>\n          <b>Initial Step:<\/b>\n          <input type='text' size='1' class='approachstepfield' value='0.32'/>\n          <br><br>\n          <b>Shrinkage:<\/b>\n          <input type='text' size='1' class='shrinkagefield' value='0.5'/>\n          <br><br>\n          <b>Min Step:<\/b>\n          <input type='text' size='1' class='minstepfield' value='0.01'/>\n          <br><br>\n          <b>Optimize for target by:<\/b>\n          <button class=\"targetbygroup widebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">\n            Selected Group\n          <\/button>\n          <br>\n          <button class=\"targetbymodifier widebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">\n            Selected Modifier\n          <\/button>\n        <\/div>\n      <\/div>\n      <div class='showonapproach'><\/div>\n    <\/div>\n  <\/div>\n  <main class=\"mdl-layout__content\">\n    <div class=\"page-content\">\n      <img class=\"humandisplay\" />\n      <br>\n      <button class=\"clearthumbsbutton mdl-button mdl-js-button mdl-button--icon mdl-button--colored\">\n        <i class=\"material-icons\">delete<\/i>\n      <\/button>\n      <button class=\"playthumbsbutton mdl-button mdl-js-button mdl-button--icon mdl-button--colored\">\n        <i class=\"material-icons\">play_arrow<\/i>\n      <\/button>\n      <button class=\"addthumbbutton mdl-button mdl-js-button mdl-button--icon mdl-button--colored\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n      <button class=\"refreshhumanbutton mdl-button mdl-js-button mdl-button--icon mdl-button--colored\">\n        <i class=\"material-icons\">replay<\/i>\n      <\/button>\n      <div class='thumbs'><\/div>\n    <\/div>\n  <\/main>\n<\/div>\n","cmd":[{"java":"umszly17da52337bcz24","name":"modify","id":"lqpzoq17da52337bfs25"},{"java":"symshm17da533340cq2d","name":"maximize","id":"tnpizw17da5333411p2e"},{"java":"yllhnn17da5373095x30","name":"snapshot","id":"vrsuzj17da537309bg31"},{"java":"ggluqx17da53e16b0g33","name":"landmarks","id":"gzmyzo17da53e16b5q34"},{"java":"jkzsmi17da541e32ar36","name":"reset_camera","id":"xmyiwl17da541e32fv37"},{"java":"yhkqkg17da5c937e5i39","name":"list_modifiers","id":"zmviwv17da5c937e9x3a"},{"java":"ngiiux17daa0fcb3ep18","name":"get_modifier_value","id":"uzrvsu17daa0fcb45h19"},{"java":"jtstjp17daf662805m30","name":"set_target","id":"yrpzyo17daf662808v31"},{"java":"nzrynu17db56e988dw2a","name":"approach_target","id":"wzjxxn17db56e9891i2b"},{"java":"vgumpy17dc99a3f23k17","name":"optimize_rotation","id":"qoyyiu17dc99a3f25i18"}],"three":{"controls":[],"assets":[],"behaviors":[],"animations":[],"poses":[]},"db":"calcpose","desc":""},"id":"mmxvzr17da51ce4ffq23","sessionid":"jvgvwg16b7a4d277bt3","time":1639941428458,"addr":"/0:0:0:0:0:0:0:1:50520","username":"admin"}